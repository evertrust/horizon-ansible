---
- name: Centralized enrollment

  vars_files:
    - ../../../credentials.yml

  hosts: "{{ hosts }}"

  tasks:
  - name: Centralize enrollment
    evertrust.horizon.horizon_enroll:

        endpoint: "{{ endpoint }}"
        x_api_id: "{{ id }}"
        x_api_key: "{{ key }}"

        profile: "{{ profile }}"
        mode: "centralized"
        key_type: "rsa-2048"
        password: "{{ password }}"
        
        subject:
          cn.1: "my cn ansible"
        sans:
          dnsname.1: "my dns ansible"
        labels: 
          label1: "test"
        team: "test"
        owner: "test"